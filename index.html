<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FIRST Executive Circle — RM Dashboard</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <style>
    :root{
      --bg:#0f1222; --panel:#181c33; --muted:#253058; --text:#e8ecff; --sub:#a9b2d7; --accent:#ff2f54; --accent-2:#e21; --ok:#2ecc71; --warn:#f1c40f; --bad:#e74c3c; --brand:#c70039; --card:#151936;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:linear-gradient(180deg,#0f1222, #0b0e1a);color:var(--text);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;}
    header{position:sticky;top:0;z-index:20;background:rgba(15,18,34,.8);backdrop-filter:blur(10px);border-bottom:1px solid #1f2545}
    .wrap{max-width:1400px;margin:0 auto;padding:12px 20px}
    .brand{display:flex;gap:12px;align-items:center}
    .brand .dot{width:12px;height:12px;border-radius:50%;background:linear-gradient(135deg,#ff416c,#ff4b2b)}
    .brand h1{font-size:18px;margin:0;font-weight:800;letter-spacing:.5px}
    .grid{display:grid;gap:16px}
    .kpi{display:grid;grid-template-columns:repeat(4,minmax(0,1fr));gap:16px}
    .card{background:linear-gradient(180deg,var(--panel),#12162b);border:1px solid #21274b;border-radius:16px;padding:16px;box-shadow:0 6px 30px rgba(0,0,0,.25)}
    .card h3{margin:0 0 6px 0;font-size:12px;letter-spacing:1px;text-transform:uppercase;color:#9fb0ff}
    .knum{font-size:28px;font-weight:800}
    .muted{color:var(--sub);font-size:12px}
    .row{display:flex;gap:16px;align-items:stretch}
    .col{flex:1}
    .gauge{display:grid;place-items:center}
    .gauge svg{width:180px;height:120px}
    .priority-list{list-style:none;margin:0;padding:0;display:grid;gap:10px}
    .priority-list li{padding:10px 12px;border:1px dashed #2a3466;border-radius:12px;background:#121733}
    .badge{padding:3px 8px;border-radius:999px;font-size:11px;border:1px solid #2a3466}
    .badge.ok{background:#0e2e20;border-color:#1c6d48;color:#6ff1ab}
    .badge.warn{background:#2e2a0e;border-color:#7d6a1a;color:#f9e27a}
    .badge.bad{background:#2e0e10;border-color:#7d1a21;color:#ffa4b1}
    .revenue{display:flex;gap:16px;align-items:center}
    .bar{height:10px;background:#202954;border-radius:999px;overflow:hidden;flex:1}
    .bar>span{display:block;height:100%;background:linear-gradient(90deg,#ff416c,#ff4b2b)}
    .section-title{display:flex;align-items:center;justify-content:space-between;margin:6px 0 10px}
    .toolbar{display:flex;gap:8px}
    .button{background:#1a2042;color:#d7defa;border:1px solid #2a3466;border-radius:12px;padding:8px 12px;font-size:12px;cursor:pointer}
    .button.ghost{background:transparent}
    .clients{display:grid;grid-template-columns:repeat(4,minmax(0,1fr));gap:16px}
    @media(max-width:1200px){.clients{grid-template-columns:repeat(2,minmax(0,1fr));}.kpi{grid-template-columns:repeat(2,minmax(0,1fr));}}
    @media(max-width:700px){.clients{grid-template-columns:1fr}.row{flex-direction:column}}
    .client{position:relative;display:grid;grid-template-columns:56px 1fr;gap:12px;align-items:center;padding:12px;border-radius:14px;background:linear-gradient(180deg,#141a36,#0d1230);border:1px solid #242c58;cursor:pointer;transition:.2s transform}
    .client:hover{transform:translateY(-2px)}
    .avatar{width:56px;height:56px;border-radius:12px;background:#121733;display:grid;place-items:center;border:1px solid #2c3570;font-weight:700}
    .label{font-size:12px;color:var(--sub)}
    .tag{font-size:10px;border:1px solid #2a3466;border-radius:999px;padding:2px 8px;margin-left:6px}
    .indicators{display:flex;gap:8px;margin-top:8px}
    .ind{flex:1;height:6px;background:#202954;border-radius:999px;overflow:hidden}
    .ind>span{display:block;height:100%}
    .health-ok{background:linear-gradient(90deg,#19d094,#2af598)}
    .health-warn{background:linear-gradient(90deg,#f8d34a,#ff9f43)}
    .health-bad{background:linear-gradient(90deg,#ff6b6b,#ff4757)}
    .status{position:absolute;top:8px;right:8px}
    .status .badge{font-weight:600}
    /* Drawer */
    .drawer{position:fixed;inset:0;display:none}
    .drawer.open{display:block}
    .backdrop{position:absolute;inset:0;background:rgba(5,8,20,.5)}
    .panel{position:absolute;right:0;top:0;height:100%;width:min(680px,100%);background:#0f132a;border-left:1px solid #222a57;box-shadow:-12px 0 40px rgba(0,0,0,.4);display:flex;flex-direction:column}
    .panel header{position:relative;background:transparent;border:none}
    .panel .wrap{padding:16px 20px}
    .close{position:absolute;right:16px;top:12px;background:#1a2042;border:1px solid #2a3466;color:#cdd6ff;border-radius:10px;padding:6px 10px;cursor:pointer}
    .profile{display:grid;grid-template-columns:64px 1fr auto;gap:12px;align-items:center}
    .profile .avatar{width:64px;height:64px;border-radius:14px}
    .stack{display:grid;gap:6px}
    .mini-grid{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:12px}
    .table{width:100%;border-collapse:collapse}
    .table th,.table td{border-bottom:1px solid #232a54;padding:8px 6px;font-size:13px;text-align:left}
    .pill{padding:4px 8px;border-radius:999px;border:1px solid #2a3466;font-size:11px}
    .ok{color:#7dffb6;border-color:#2b6d4f;background:#0e2c1f}
    .warn{color:#ffe27a;border-color:#7d6a1a;background:#2e2a0e}
    .bad{color:#ff9aa8;border-color:#7d1a21;background:#2e0e10}
    .charts{display:grid;grid-template-columns:1fr 1fr;gap:16px}
    .chart-card{padding:12px;border:1px solid #222a57;border-radius:14px;background:#121733}
    .funnel{display:grid;gap:10px}
    .funnel .stage{background:#1b2146;border:1px solid #2a3466;border-radius:10px;padding:6px 10px;display:flex;justify-content:space-between;align-items:center}
    .notif-grid{display:grid;grid-template-columns:2fr 1fr;gap:16px}
    .notif-list{max-height:300px;overflow:auto;display:grid;gap:10px}
    .notif{border:1px solid #2a3466;border-radius:12px;padding:10px;background:#121733;display:flex;justify-content:space-between;align-items:center}
    .filters{display:flex;gap:8px;flex-wrap:wrap}
    .network{height:360px;border:1px solid #222a57;border-radius:14px;background:#121733}
    footer{opacity:.7;padding:30px 0;text-align:center}
    .switch{display:inline-flex;align-items:center;gap:8px}
    .switch input{appearance:none;width:38px;height:22px;border-radius:999px;background:#2a3466;position:relative;outline:none;cursor:pointer}
    .switch input:checked{background:#ff4b2b}
    .switch input:after{content:"";position:absolute;top:3px;left:3px;width:16px;height:16px;background:#fff;border-radius:50%;transition:.2s}
    .switch input:checked:after{left:19px}
  </style>
</head>
<body>
  <header>
    <div class="wrap" style="display:flex;justify-content:space-between;align-items:center;gap:12px">
      <div class="brand"><span class="dot"></span><h1>FIRST Executive Circle — RM Dashboard</h1><span class="tag">IDFC Theme</span></div>
      <div class="toolbar">
        <label class="switch"><input id="themeToggle" type="checkbox"><span class="muted">Dark Mode</span></label>
        <button class="button" id="refreshAI">⚡ Regenerate Priorities</button>
        <button class="button ghost" id="openSettings">⚙️ Settings</button>
      </div>
    </div>
  </header>

  <main class="wrap grid" style="margin-top:12px">
    <!-- Executive Summary -->
    <section class="grid" style="gap:16px">
      <div class="kpi">
        <div class="card">
          <h3>Total CXO Clients</h3>
          <div class="knum" id="kpiClients">32</div>
          <div class="muted">+3 this quarter</div>
        </div>
        <div class="card">
          <h3>Family Members Linked</h3>
          <div class="knum" id="kpiFamily">89</div>
          <div class="muted">Avg 2.8 per CXO</div>
        </div>
        <div class="card">
          <h3>Aggregate AUM</h3>
          <div class="knum" id="kpiAUM">₹ 412 Cr</div>
          <div class="muted">MTD +₹ 6.4 Cr</div>
        </div>
        <div class="card gauge">
          <h3>Health Score</h3>
          <svg viewBox="0 0 180 110">
            <defs>
              <linearGradient id="gOk" x1="0" x2="1"><stop offset="0%" stop-color="#ff6b6b"/><stop offset="50%" stop-color="#f8d34a"/><stop offset="100%" stop-color="#19d094"/></linearGradient>
            </defs>
            <path d="M10,100 A80,80 0 0 1 170,100" fill="none" stroke="#1f2650" stroke-width="16" stroke-linecap="round"/>
            <path id="healthArc" d="M10,100 A80,80 0 0 1 170,100" fill="none" stroke="url(#gOk)" stroke-width="16" stroke-dasharray="0 500" stroke-linecap="round"/>
            <text id="healthText" x="90" y="95" text-anchor="middle" font-size="28" font-weight="800">—</text>
          </svg>
          <div class="muted">0–49 Red • 50–79 Amber • 80–100 Green</div>
        </div>
      </div>

      <div class="row">
        <div class="card col">
          <div class="section-title"><h3>Today’s Priorities</h3><span class="badge warn">AI Suggested</span></div>
          <ul class="priority-list" id="priorityList"></ul>
        </div>
        <div class="card col">
          <div class="section-title"><h3>Revenue Impact Snapshot</h3><span class="badge ok" id="revDelta">92% of QTD target</span></div>
          <div class="revenue">
            <div style="min-width:120px">
              <div class="muted">QTD Revenue</div>
              <div class="knum" id="revQTD">₹ 3.7 Cr</div>
            </div>
            <div class="bar"><span id="revBar" style="width:0%"></span></div>
          </div>
          <div class="muted" style="margin-top:8px">MTD: <strong id="revMTD">₹ 1.2 Cr</strong> • Target: <strong id="revTarget">₹ 4.0 Cr</strong></div>
        </div>
      </div>
    </section>

    <!-- Client Health & Alert Panel -->
    <section>
      <div class="section-title"><h3>Client Health & Alerts</h3>
        <div class="filters">
          <select id="tierFilter" class="button">
            <option value="all">All Tiers</option>
            <option>Executive</option>
            <option>Wealth</option>
            <option>Private</option>
          </select>
          <select id="statusFilter" class="button">
            <option value="all">All Status</option>
            <option value="ok">On Track</option>
            <option value="watch">Watch</option>
            <option value="bad">Needs Attention</option>
          </select>
          <input id="searchBox" class="button" placeholder="Search name or company" />
        </div>
      </div>
      <div class="clients" id="clients"></div>
    </section>

    <!-- Notifications & Actions -->
    <section class="notif-grid">
      <div class="card">
        <div class="section-title"><h3>Action-Items & Notifications</h3>
          <div class="filters">
            <select id="notifType" class="button">
              <option value="all">All</option>
              <option value="loan">Loan</option>
              <option value="inactivity">Inactivity</option>
              <option value="family">Family</option>
            </select>
            <select id="notifUrgency" class="button">
              <option value="all">Any Urgency</option>
              <option value="high">High</option>
              <option value="med">Medium</option>
              <option value="low">Low</option>
            </select>
            <button class="button" id="bulkEmail">✉️ Send Group Email</button>
            <button class="button" id="bulkSchedule">📆 Schedule Group Event</button>
          </div>
        </div>
        <div class="notif-list" id="notifList"></div>
      </div>
      <div class="card">
        <div class="section-title"><h3>Cross‑sell Funnel</h3><span class="badge">Leads → Revenue</span></div>
        <div class="funnel" id="funnel"></div>
      </div>
    </section>

    <!-- Analytics & Network -->
    <section class="grid" style="grid-template-columns:1.2fr .8fr;gap:16px">
      <div class="card">
        <div class="section-title"><h3>Analytics</h3></div>
        <div class="charts">
          <div class="chart-card"><canvas id="chartRevenue"></canvas></div>
          <div class="chart-card"><canvas id="chartBenchmark"></canvas></div>
          <div class="chart-card"><canvas id="chartFamily"></canvas></div>
          <div class="chart-card"><canvas id="chartRadar"></canvas></div>
        </div>
      </div>
      <div class="card">
        <div class="section-title"><h3>Network & Referrals</h3><span class="badge">CXO Graph</span></div>
        <canvas id="networkCanvas" class="network"></canvas>
        <div class="muted" style="margin-top:8px">Nodes = CXOs • Lines = referrals/connections</div>
      </div>
    </section>

    <footer class="muted">© 2025 FIRST Executive Circle • Sample data for demo • Build for GitHub Pages (single HTML file)</footer>
  </main>

  <!-- Drawer: Client Detail -->
  <div class="drawer" id="drawer">
    <div class="backdrop" onclick="closeDrawer()"></div>
    <div class="panel">
      <header>
        <div class="wrap">
          <button class="close" onclick="closeDrawer()">✕ Close</button>
          <div class="profile">
            <div id="dAvatar" class="avatar">CX</div>
            <div class="stack">
              <div style="font-weight:800;font-size:18px" id="dName">—</div>
              <div class="muted" id="dMeta">—</div>
              <div><span class="pill" id="dTier">—</span> <span class="pill" id="dTenure">—</span></div>
            </div>
            <div class="stack" style="text-align:right">
              <div class="muted">Churn Risk</div>
              <div id="dChurn" class="knum" style="font-size:22px">—</div>
              <div class="muted">Referral Likelihood: <strong id="dReferral">—</strong></div>
            </div>
          </div>
        </div>
      </header>
      <div class="wrap" style="display:grid;gap:16px;flex:1;overflow:auto">
        <div class="mini-grid">
          <div class="chart-card">
            <h3>Product Holdings</h3>
            <table class="table" id="dHoldings"></table>
          </div>
          <div class="chart-card">
            <h3>Life Events & Next Best</h3>
            <ul id="dEvents" class="priority-list" style="height:160px;overflow:auto"></ul>
            <div class="muted" style="margin-top:6px">Next‑Best Product: <strong id="dNBP">—</strong></div>
          </div>
          <div class="chart-card" style="grid-column:1/3">
            <h3>Engagement Timeline</h3>
            <canvas id="chartTimeline"></canvas>
          </div>
        </div>
      </div>
      <div class="wrap" style="border-top:1px solid #202652;display:flex;justify-content:flex-end;gap:8px">
        <button class="button" id="actCall">📞 Call</button>
        <button class="button" id="actMeet">📅 Schedule Meeting</button>
        <button class="button" id="actReco">🎯 Send Recommendation</button>
      </div>
    </div>
  </div>

  <!-- Settings Modal (very light, in-page) -->
  <div class="drawer" id="settings">
    <div class="backdrop" onclick="toggleSettings(false)"></div>
    <div class="panel">
      <header>
        <div class="wrap">
          <button class="close" onclick="toggleSettings(false)">✕ Close</button>
          <div style="font-weight:800;font-size:18px">Settings & Personalization</div>
        </div>
      </header>
      <div class="wrap" style="display:grid;gap:16px;overflow:auto">
        <div class="card" style="background:#101538">
          <h3>Threshold Configuration</h3>
          <div class="row" style="align-items:center">
            <div class="col">Health threshold (<span id="thVal">70</span>)</div>
            <input type="range" id="thInput" min="40" max="90" value="70" class="col" />
          </div>
        </div>
        <div class="card" style="background:#101538">
          <h3>Notification Preferences</h3>
          <label><input type="checkbox" checked> Email</label>
          <label><input type="checkbox"> SMS</label>
          <label><input type="checkbox" checked> In-Dashboard</label>
        </div>
        <div class="card" style="background:#101538">
          <h3>Theme</h3>
          <button class="button" onclick="setTheme('idfc')">IDFC Red</button>
          <button class="button" onclick="setTheme('dark')">Dark</button>
          <button class="button" onclick="setTheme('light')">Light</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ===== Mock Data =====
    const clients = [
      {id:1,name:"Aarav Menon",title:"CFO",company:"Sunrise Cements",tier:"Executive",status:"watch",scores:{activity:62,depth:54,family:35,cross:68,health:72},family:2,tenure:"3.1y",phone:"+91-98xx-xxx",avatar:"AM",holdings:[['Premium SA', '₹ 54L'],['MF Portfolio', '₹ 2.3Cr'],['Home Loan', '₹ 78L']],events:['Spouse KYC pending','Daughter turns 18 in 2 months','Home loan renewal in 90 days'],nbp:'NRE FD + Family Credit Card',churn:0.18,referral:0.42, timeline:[5,8,6,9,7,6,8,9,5,6,7,10]},
      {id:2,name:"Bhavana Iyer",title:"CTO",company:"Aether Labs",tier:"Wealth",status:"ok",scores:{activity:84,depth:88,family:90,cross:75,health:90},family:4,tenure:"5.6y",phone:"+91-97xx-xxx",avatar:"BI",holdings:[['Prem. SA', '₹ 1.1Cr'],['Bonds', '₹ 3.4Cr'],['ESOP Finance', '₹ 60L']],events:['Son education loan eligibility','Anniversary next week'],nbp:'Ultra Short MF + HNI Bond',churn:0.06,referral:0.7, timeline:[7,7,8,7,9,8,9,8,8,9,8,9]},
      {id:3,name:"Chetan Batra",title:"CEO",company:"Orbit Foods",tier:"Private",status:"bad",scores:{activity:38,depth:40,family:22,cross:31,health:42},family:1,tenure:"1.4y",phone:"+91-99xx-xxx",avatar:"CB",holdings:[['SA', '₹ 18L'],['MF', '₹ 80L']],events:['Inactivity 21 days','KYC revalidation due'],nbp:'Priority Wealth Review',churn:0.44,referral:0.25, timeline:[4,3,2,4,3,2,3,2,3,2,3,2]},
      {id:4,name:"Diya Kapoor",title:"VP HR",company:"Kite Mobility",tier:"Executive",status:"ok",scores:{activity:76,depth:64,family:58,cross:62,health:80},family:3,tenure:"2.8y",phone:"+91-98xx-xxx",avatar:"DK",holdings:[['SA', '₹ 36L'],['Goal MF', '₹ 1.8Cr'],['Car Loan', '₹ 18L']],events:['Birthday today','Car loan top‑up eligibility'],nbp:'Wealth Plus + Top-up',churn:0.11,referral:0.55, timeline:[6,7,7,6,8,7,7,7,6,7,8,7]},
      {id:5,name:"Ehsan Qureshi",title:"CIO",company:"Tycho Aerospace",tier:"Wealth",status:"watch",scores:{activity:59,depth:67,family:40,cross:52,health:69},family:2,tenure:"4.0y",phone:"+91-90xx-xxx",avatar:"EQ",holdings:[['Prem. SA', '₹ 62L'],['NRI NRO', '₹ 1.4Cr']],events:['Spouse add‑on CC offer','NRI FD maturity in 30 days'],nbp:'NRI FD rollover + Add‑on CC',churn:0.2,referral:0.36, timeline:[5,6,5,6,6,5,6,6,5,6,5,6]},
      {id:6,name:"Falguni Shah",title:"CFO",company:"Quantum Health",tier:"Executive",status:"ok",scores:{activity:82,depth:72,family:66,cross:69,health:85},family:3,tenure:"6.3y",phone:"+91-97xx-xxx",avatar:"FS",holdings:[['SA', '₹ 54L'],['Bonds', '₹ 2.9Cr'],['HL', '₹ 65L']],events:['HL interest reset in 60 days'],nbp:'Tax‑free Bonds + Rate Check',churn:0.08,referral:0.62, timeline:[7,8,8,7,8,8,8,9,8,8,9,9]},
      {id:7,name:"Girish Rao",title:"Director",company:"Vertex Media",tier:"Executive",status:"watch",scores:{activity:55,depth:50,family:38,cross:44,health:63},family:1,tenure:"2.2y",phone:"+91-96xx-xxx",avatar:"GR",holdings:[['SA', '₹ 22L'],['MF SIP', '₹ 60k/m']],events:['Inactivity 14 days'],nbp:'Step‑up SIP + Family SA',churn:0.26,referral:0.32, timeline:[6,5,6,5,6,5,6,5,6,5,6,5]},
      {id:8,name:"Hema Reddy",title:"COO",company:"Nimbus Retail",tier:"Private",status:"ok",scores:{activity:71,depth:79,family:84,cross:73,health:88},family:5,tenure:"7.1y",phone:"+91-95xx-xxx",avatar:"HR",holdings:[['Prem. SA', '₹ 1.4Cr'],['Alt Inv.', '₹ 4.2Cr']],events:['Child turning 18 in 45 days'],nbp:'Edu Loan + Family CC',churn:0.07,referral:0.64, timeline:[8,9,8,9,8,9,9,9,8,9,9,9]},
    ];

    const notifications = [
      {type:'loan', urgency:'high', text:'Home loan renewal due in 30 days — Aarav Menon', clientId:1},
      {type:'inactivity', urgency:'med', text:'No login in 14 days — Girish Rao', clientId:7},
      {type:'family', urgency:'low', text:'Spouse KYC pending — Aarav Menon', clientId:1},
      {type:'loan', urgency:'high', text:'Interest rate reset in 60 days — Falguni Shah', clientId:6},
      {type:'family', urgency:'med', text:'Child turns 18 in 45 days — Hema Reddy', clientId:8},
    ];

    const funnelData = [
      {stage:'Leads', value: 124},
      {stage:'Offers', value: 73},
      {stage:'Accepted', value: 44},
      {stage:'Revenue', value: 18},
    ];

    // ===== Executive Summary logic =====
    function setHealth(score){
      const arc = document.getElementById('healthArc');
      const text = document.getElementById('healthText');
      const maxDash = 260; // visual
      const dash = Math.round((score/100)*maxDash);
      arc.setAttribute('stroke-dasharray', dash+" "+(500-dash));
      text.textContent = score;
      text.setAttribute('fill', score>=80? '#7dffb6' : score>=50? '#ffe27a' : '#ff9aa8');
    }

    function setRevenue(qtd=3.7, target=4.0, mtd=1.2){
      const pct = Math.min(100, Math.round((qtd/target)*100));
      document.getElementById('revQTD').textContent = `₹ ${qtd.toFixed(1)} Cr`;
      document.getElementById('revTarget').textContent = `₹ ${target.toFixed(1)} Cr`;
      document.getElementById('revMTD').textContent = `₹ ${mtd.toFixed(1)} Cr`;
      document.getElementById('revBar').style.width = pct+"%";
      const badge = document.getElementById('revDelta');
      badge.textContent = `${pct}% of QTD target`;
      badge.className = 'badge '+(pct>=90? 'ok': pct>=70? 'warn': 'bad');
    }

    const prioritySeeds = [
      'Call Chetan (inactivity 21d) — discuss portfolio review',
      'Wish Diya happy birthday — propose Wealth Plus + top‑up',
      'Roll over NRI FD (Ehsan) — maturity in 30 days',
      'Prep HL renewal options (Aarav) — 9.25% vs 9.05%',
      'Share HNI Bond list (Falguni) — tax‑free tranche',
      'Add family CC (Hema) — child turns 18 in 45 days'
    ];

    function regenPriorities(){
      const list = document.getElementById('priorityList');
      list.innerHTML = '';
      const picked = prioritySeeds.sort(()=>.5-Math.random()).slice(0,5);
      picked.forEach((t,i)=>{
        const li = document.createElement('li');
        li.innerHTML = `<strong>${i+1}. </strong>${t}`;
        list.appendChild(li);
      });
    }

    // ===== Clients grid =====
    function statusBadge(status){
      if(status==='ok') return '<span class="badge ok">🟢 On Track</span>';
      if(status==='watch') return '<span class="badge warn">🟡 Watch</span>';
      return '<span class="badge bad">🔴 Needs Attention</span>';
    }

    function healthClass(score){
      return score>=80? 'health-ok': score>=50? 'health-warn':'health-bad';
    }

    function renderClients(){
      const tier = document.getElementById('tierFilter').value;
      const stat = document.getElementById('statusFilter').value;
      const q = document.getElementById('searchBox').value.toLowerCase();
      const box = document.getElementById('clients');
      box.innerHTML='';
      clients
        .filter(c=> tier==='all' || c.tier===tier)
        .filter(c=> stat==='all' || c.status===stat)
        .filter(c=> c.name.toLowerCase().includes(q)||c.company.toLowerCase().includes(q))
        .forEach(c=>{
          const el = document.createElement('div');
          el.className='client';
          el.innerHTML = `
            <div class="avatar">${c.avatar}</div>
            <div>
              <div style="font-weight:700">${c.name} <span class="tag">${c.tier}</span></div>
              <div class="label">${c.title}, ${c.company}</div>
              <div class="indicators">
                <div class="ind"><span class="${healthClass(c.scores.activity)}" style="width:${c.scores.activity}%"></span></div>
                <div class="ind"><span class="${healthClass(c.scores.depth)}" style="width:${c.scores.depth}%"></span></div>
                <div class="ind"><span class="${healthClass(c.scores.family)}" style="width:${c.scores.family}%"></span></div>
                <div class="ind"><span class="${healthClass(c.scores.cross)}" style="width:${c.scores.cross}%"></span></div>
              </div>
            </div>
            <div class="status">${statusBadge(c.status)}</div>
          `;
          el.onclick=()=>openDrawer(c.id);
          box.appendChild(el);
        });
    }

    // ===== Notifications & Funnel =====
    function renderNotifs(){
      const t = document.getElementById('notifType').value;
      const u = document.getElementById('notifUrgency').value;
      const list = document.getElementById('notifList');
      list.innerHTML='';
      notifications
        .filter(n=> t==='all'||n.type===t)
        .filter(n=> u==='all'||n.urgency===u)
        .forEach(n=>{
          const el = document.createElement('div');
          el.className='notif';
          el.innerHTML = `<div>${n.text}</div><div><button class="button">Mark done</button></div>`;
          list.appendChild(el);
        })
    }

    function renderFunnel(){
      const max = Math.max(...funnelData.map(f=>f.value));
      const box = document.getElementById('funnel');
      box.innerHTML='';
      funnelData.forEach(f=>{
        const width = Math.round((f.value/max)*100);
        const row = document.createElement('div');
        row.className='stage';
        row.innerHTML = `<div>${f.stage}</div><div style="flex:1;margin:0 10px"><div class="bar"><span style="width:${width}%"></span></div></div><div>${f.value}</div>`;
        box.appendChild(row);
      });
    }

    // ===== Drawer (Client details) =====
    let timelineChart;
    function openDrawer(id){
      const c = clients.find(x=>x.id===id);
      if(!c) return;
      document.getElementById('dAvatar').textContent = c.avatar;
      document.getElementById('dName').textContent = c.name;
      document.getElementById('dMeta').textContent = `${c.title}, ${c.company} • ${c.phone}`;
      const tier = document.getElementById('dTier');
      tier.textContent = c.tier; tier.className='pill '+(c.status==='ok'?'ok':c.status==='watch'?'warn':'bad');
      document.getElementById('dTenure').textContent = `Tenure ${c.tenure}`;
      document.getElementById('dChurn').textContent = Math.round(c.churn*100)+'%';
      document.getElementById('dReferral').textContent = Math.round(c.referral*100)+'%';
      // holdings
      const tbl = document.getElementById('dHoldings');
      tbl.innerHTML = '<tr><th>Product</th><th>Balance</th></tr>' + c.holdings.map(h=>`<tr><td>${h[0]}</td><td>${h[1]}</td></tr>`).join('');
      // events
      const ev = document.getElementById('dEvents');
      ev.innerHTML = '';
      c.events.forEach(e=>{const li=document.createElement('li');li.textContent=e;ev.appendChild(li)});
      document.getElementById('dNBP').textContent = c.nbp;
      // timeline chart
      const ctx = document.getElementById('chartTimeline');
      timelineChart && timelineChart.destroy();
      timelineChart = new Chart(ctx,{
        type:'line',
        data:{labels:['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'],datasets:[{label:'Engagement',data:c.timeline,tension:.35}]},
        options:{responsive:true,plugins:{legend:{display:false}},scales:{y:{grid:{color:'#202652'}},x:{grid:{display:false}}}}
      });
      document.getElementById('drawer').classList.add('open');
    }
    function closeDrawer(){document.getElementById('drawer').classList.remove('open');}

    // ===== Analytics charts =====
    function initCharts(){
      new Chart(document.getElementById('chartRevenue'),{
        type:'bar',
        data:{labels:['You','Team Avg'],datasets:[{label:'Revenue (Cr)',data:[3.7,3.1]}]},
        options:{plugins:{legend:{display:false}},scales:{y:{beginAtZero:true}}}
      });
      new Chart(document.getElementById('chartBenchmark'),{
        type:'line',
        data:{labels:['Q1','Q2','Q3','Q4'],datasets:[{label:'Selected CXO',data:[82,78,90,88],tension:.35},{label:'Industry Peers',data:[76,74,80,79],tension:.35}]},
        options:{scales:{y:{beginAtZero:true,max:100}}}
      });
      new Chart(document.getElementById('chartFamily'),{
        type:'line',
        data:{labels:['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug'],datasets:[{label:'Family Members Onboarded',data:[8,10,12,14,18,22,26,29],fill:true}]},
        options:{plugins:{legend:{display:false}}}
      });
      new Chart(document.getElementById('chartRadar'),{
        type:'radar',
        data:{labels:['Activity','Depth','Family','Cross‑sell'],datasets:[{label:'You',data:[78,74,68,70]},{label:'Team',data:[72,69,60,66]}]},
        options:{scales:{r:{suggestedMin:0,suggestedMax:100,grid:{color:'#273160'}}}}
      });
    }

    // ===== Simple Network Canvas =====
    function initNetwork(){
      const cvs = document.getElementById('networkCanvas');
      const ctx = cvs.getContext('2d');
      const w = cvs.width = cvs.clientWidth; const h=cvs.height=cvs.clientHeight;
      const nodes = clients.map((c,i)=>({x:(Math.random()*0.8+0.1)*w,y:(Math.random()*0.7+0.15)*h,label:c.avatar,color:c.status==='ok'?'#7dffb6':c.status==='watch'?'#ffe27a':'#ff9aa8'}));
      const links = [];
      for(let i=0;i<nodes.length;i++){
        for(let j=i+1;j<nodes.length;j++){
          if(Math.random()<0.08) links.push([i,j]);
        }
      }
      ctx.clearRect(0,0,w,h);
      // draw links
      ctx.globalAlpha = .5; ctx.lineWidth=1;
      links.forEach(([i,j])=>{ctx.strokeStyle='#2a3466';ctx.beginPath();ctx.moveTo(nodes[i].x,nodes[i].y);ctx.lineTo(nodes[j].x,nodes[j].y);ctx.stroke();});
      // draw nodes
      ctx.globalAlpha=1;
      nodes.forEach(n=>{ctx.fillStyle=n.color;ctx.beginPath();ctx.arc(n.x,n.y,8,0,Math.PI*2);ctx.fill();ctx.fillStyle='#d7defa';ctx.font='10px Inter';ctx.textAlign='center';ctx.fillText(n.label,n.x,n.y-12)});
    }

    // ===== Settings & Themes =====
    function toggleSettings(open=true){document.getElementById('settings').classList.toggle('open',open)}
    function setTheme(mode){
      const r = document.documentElement.style;
      if(mode==='light'){
        r.setProperty('--bg','#f6f7fb');r.setProperty('--panel','#ffffff');r.setProperty('--text','#0e1330');r.setProperty('--sub','#4a5378');r.setProperty('--card','#ffffff');
      }else if(mode==='idfc'){
        r.setProperty('--accent','#c70039');r.setProperty('--brand','#c70039');r.setProperty('--panel','#fee');
      }else{ // dark
        r.setProperty('--bg','#0f1222');r.setProperty('--panel','#181c33');r.setProperty('--text','#e8ecff');r.setProperty('--sub','#a9b2d7');r.setProperty('--card','#151936');
      }
    }

    // ===== Events =====
    document.getElementById('tierFilter').onchange=renderClients;
    document.getElementById('statusFilter').onchange=renderClients;
    document.getElementById('searchBox').oninput=renderClients;
    document.getElementById('notifType').onchange=renderNotifs;
    document.getElementById('notifUrgency').onchange=renderNotifs;
    document.getElementById('refreshAI').onclick=regenPriorities;
    document.getElementById('openSettings').onclick=()=>toggleSettings(true);
    document.getElementById('thInput').oninput=(e)=>{document.getElementById('thVal').textContent=e.target.value}
    document.getElementById('themeToggle').onchange=(e)=> setTheme(e.target.checked? 'dark':'light');

    // ===== Boot =====
    setHealth(84);
    setRevenue(3.7,4.0,1.2);
    regenPriorities();
    renderClients();
    renderNotifs();
    renderFunnel();
    initCharts();
    initNetwork();

    window.addEventListener('resize', initNetwork);
  </script>
</body>
</html>
